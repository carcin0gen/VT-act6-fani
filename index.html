<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Avanzado D3.js</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        .dashboard {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            padding: 20px;
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
        }
        .chart-container {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .chart-title {
            font-size: 1.2em;
            margin-bottom: 10px;
            color: #333;
            text-align: center;
            font-weight: bold;
        }
        svg {
            display: block;
            margin: 0 auto;
            background: #f9f9f9;
        }
        .chart-description {
            text-align: center;
            margin-top: 10px;
            font-family: Arial, sans-serif;
            color: #666;
            font-size: 0.9em;
        }
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <h1 style="text-align: center; margin: 20px 0; color: #333;">Dashboard Interactivo D3.js de Fani :3</h1>
    
    <div class="dashboard">
        <!-- Coordenadas del Mouse -->
        <div class="chart-container">
            <div class="chart-title">Coordenadas del Mouse</div>
            <svg id="coords" width="300" height="300"></svg>
        </div>

        <!-- Brush Linking -->
        <div class="chart-container">
            <div class="chart-title">Brush Linking Interactivo</div>
            <div style="display: flex; justify-content: center;">
                <svg id="brush1" width="300" height="300" style="margin-right: 10px;"></svg>
                <svg id="brush2" width="300" height="300"></svg>
            </div>
        </div>

        <!-- Drag & Drop -->
        <div class="chart-container">
            <div class="chart-title">Drag & Drop de Elementos</div>
            <svg id="dragdrop" width="300" height="200"></svg>
        </div>

        <!-- Stagger Effect -->
        <div class="chart-container">
            <div class="chart-title">Efecto Stagger Animado</div>
            <svg id="stagger" width="300" height="200"></svg>
            <div class="chart-description">Haz clic en el gráfico para ver el efecto de animación</div>
        </div>

        <!-- Lissajous -->
        <div class="chart-container" style="grid-column: span 2;">
            <div class="chart-title">Curva de Lissajous</div>
            <svg id="lissajous" width="600" height="300"></svg>
        </div>
    </div>

    <script>
    // 1. Coordenadas del Mouse
    function setupCoords() {
        const svg = d3.select("#coords");
        const text = svg.append('text')
            .attr('font-family', 'Arial')
            .attr('font-size', '12px')
            .attr('fill', 'black');

        svg.on('mousemove', function(event) {
            const [x, y] = d3.pointer(event);
            text.attr('x', x + 10)
               .attr('y', y + 5)
               .text(`(${Math.round(x)}, ${Math.round(y)})`);
        }).on('mouseleave', () => text.text(''));
    }

    // 2. Brush Linking
    function setupBrush() {
        // Datos de ejemplo - reemplaza con tus datos reales
        const data = Array.from({length: 50}, () => ({
            A: Math.random() * 280 + 10,
            B: Math.random() * 280 + 10
        }));

        const svg1 = d3.select("#brush1"), svg2 = d3.select("#brush2");
        const colorScale = d3.scaleLinear()
            .domain([0, 150, 300])
            .range(["green", "yellow", "red"]);

        function updateCircles(svg, data, color) {
            svg.selectAll("circle").remove();
            svg.selectAll("circle")
                .data(data)
                .enter()
                .append("circle")
                .attr("r", 5)
                .attr("cx", d => d.A)
                .attr("cy", d => d.B)
                .attr("fill", color)
                .attr("fill-opacity", 0.6);
        }

        updateCircles(svg1, data, "blue");
        updateCircles(svg2, data, "green");

        svg1.on("mousemove", function(event) {
            const [x, y] = d3.pointer(event);
            data.forEach(d => {
                d.dist = Math.sqrt(Math.pow(d.A - x, 2) + Math.pow(d.B - y, 2));
            });
            updateCircles(svg1, data, d => colorScale(d.dist));
            updateCircles(svg2, data, d => colorScale(d.dist));
        });
    }

    // 3. Drag & Drop
    function setupDragDrop() {
        const svg = d3.select("#dragdrop");
        const colors = ["red", "green", "blue"];
        
        svg.selectAll("circle")
            .data(colors)
            .enter()
            .append("circle")
            .attr("cx", (d,i) => 50 + i*100)
            .attr("cy", 100)
            .attr("r", 20)
            .attr("fill", d => d)
            .call(d3.drag()
                .on("start", function() {
                    d3.select(this).attr("fill", "orange");
                })
                .on("drag", function(event) {
                    d3.select(this)
                        .attr("cx", event.x)
                        .attr("cy", event.y);
                })
                .on("end", function(event, d) {
                    d3.select(this).attr("fill", d);
                }));
    }

    // 4. Stagger Effect (Versión corregida)
    function setupStagger() {
        const svg = d3.select("#stagger");
        let ds1 = [2, 1, 3, 5, 7, 8, 9, 9, 9, 8, 7, 5, 3, 1, 2];
        let ds2 = [8, 9, 8, 7, 5, 3, 2, 1, 2, 3, 5, 7, 8, 9, 8];
        const n = ds1.length;
        const mx = d3.max(d3.merge([ds1, ds2]));
        
        // Ajustar escalas para el tamaño reducido
        const scX = d3.scaleLinear().domain([0, n]).range([20, 280]);
        const scY = d3.scaleLinear().domain([0, mx]).range([180, 20]);

        // Crear barras iniciales
        svg.selectAll("line")
            .data(ds1)
            .enter()
            .append("line")
            .attr("stroke", "red")
            .attr("stroke-width", 10)
            .attr("x1", (d, i) => scX(i))
            .attr("y1", scY(0))
            .attr("x2", (d, i) => scX(i))
            .attr("y2", d => scY(d));

        // Manejador de clic para animación
        svg.on("click", function(event) {
            [ds1, ds2] = [ds2, ds1];
            svg.selectAll("line")
                .data(ds1)
                .transition()
                .duration(1000)
                .delay((d, i) => 200 * i)
                .attr("y2", d => scY(d));
        });
    }

    // 5. Lissajous Curve (Versión corregida)
    function setupLissajous() {
        const svg = d3.select("#lissajous");
        let lastX = 300, lastY = 150;
        const a = 1.9, b = 3.2;
        const omega = 2 * Math.PI / 10000;
        
        d3.timer(function(t) {
            const phi = omega * t;
            const x = 300 + 200 * Math.cos(a * phi);
            const y = 150 + 100 * Math.sin(b * phi);
            
            svg.selectAll("line")
                .each(function() { this.bogus_opacity *= 0.99; })
                .attr("stroke-opacity", function() { return this.bogus_opacity; })
                .filter(function() { return this.bogus_opacity < 0.05; })
                .remove();

            svg.append("line")
                .each(function() { this.bogus_opacity = 1.0; })
                .attr("x1", lastX)
                .attr("y1", lastY)
                .attr("x2", x)
                .attr("y2", y)
                .attr("stroke", "green")
                .attr("stroke-width", 2);

            lastX = x;
            lastY = y;

            if (t > 120000) { this.stop(); }
        });
    }

    // Inicializar todo cuando el DOM esté listo
    document.addEventListener("DOMContentLoaded", () => {
        setupCoords();
        setupBrush();
        setupDragDrop();
        setupStagger();
        setupLissajous();
    });
    </script>
</body>
</html>
